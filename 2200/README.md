# 2200 Redirection: Docker Container Volumes

In this video, we will go over how to create and use Docker volumes. We will also discuss their ability to persist data outside of the container lifecycle.

We will be making use of two separate arguments: -v and --mount. Additional documentation for these options can be fond through the [Docker Docs](https://docs.docker.com/storage/volumes/).

More explanation on Docker containers and volumes can be found in the [Docker Overview](https://docs.docker.com/engine/docker-overview/).

## Transcript

Hey, everyone, we're back with our Docker Quick Start Series. 

Now, hopefully, you will forgive me for staying off camera. But since this is the second of our redirection portion of our Docker Quick Start Series, I thought it best just to get behind that command line and start talking about Docker volumes. Now we're gonna start off the way that we always do, and that's by checking our environment. Docker Container LS, Docker Container LS-A, and our Docker images. 

```
$ docker container ls
CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                   NAMES
4559deaefcb4   httpd     "httpd-foreground"       2 hours ago   Up 2 hours   0.0.0.0:80->80/tcp      sweet_williams
48812a5ebfef   nginx     "/docker-entrypoint.…"   2 hours ago   Up 2 hours   0.0.0.0:49153->80/tcp   sweet_galileo
278dd40f4569   nginx     "/docker-entrypoint.…"   3 hours ago   Up 3 hours   80/tcp                  nervous_kilby
```

```
$ docker container ls -a
CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS                    PORTS                   NAMES
4559deaefcb4   httpd     "httpd-foreground"       2 hours ago    Up 2 hours                0.0.0.0:80->80/tcp      sweet_williams
48812a5ebfef   nginx     "/docker-entrypoint.…"   2 hours ago    Up 2 hours                0.0.0.0:49153->80/tcp   sweet_galileo
278dd40f4569   nginx     "/docker-entrypoint.…"   3 hours ago    Up 3 hours                80/tcp                  nervous_kilby
5340f7259a1f   nginx     "/docker-entrypoint.…"   21 hours ago   Exited (0) 18 hours ago                           objective_blackburn
```

```
$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
nginx        latest    ae2feff98a0c   3 weeks ago   133MB
httpd        latest    dd85cdbb9987   3 weeks ago   138MB
```

Now we will note that we still have a few images on our system from our previous videos. However, I'm going to go ahead and allow these to stay on our system because we can use them when creating our containers for our Docker volumes. 

So let me go ahead and clear out my screen and we can jump right into learning a bit more about Docker volumes and how one would use them. 

```
$ clear
```

Now, Docker volumes are the preferred mechanism for persisting data that's generated by a container or that's generated to be used by a container. 

Docker volumes have several advantages, and that's first of all, we can actually use them on both Linux and Windows containers. You can actually use volume drivers to let you store volumes on a remote host or even a cloud provider. And new volumes can have their content pre-populated by a container. 

Now, we're not gonna go into these functionalities. However, I thought it was important to mention them to you in case you've been wondering, you know, is this only for Linux containers? Or do I have to use my host as that storage? So the one thing I love about Docker is how user intuitive they make their commands. So just to find out if I have any containers on this system, I simply use the command docker volume ls. 

```
$ docker volume ls
DRIVER    VOLUME NAME
```

I see that I don't have any on this system, so I can go ahead and create one with the command docker volume create (here named e.g.: devvolume). 

```
$ docker volume create devvolume
devvolume
```

Now, let's go ahead and create the volume that we see there on our lucid chart, which is gonna be our dev volume. In order to see it, let's do that docker volume ls one more time, and there you go. 

```
$ docker volume ls
DRIVER    VOLUME NAME
local     devvolume
```

We have a local volume that is a dev volume. 

Now perhaps this volume already existed on my system and I wanted to know a little bit more about it, like you used the command docker volume inspect. 

```
$ docker volume inspect devvolume
[
    {
        "CreatedAt": "2021-01-07T12:35:43Z",
        "Driver": "local",
        "Labels": {},
        "Mountpoint": "/var/lib/docker/volumes/devvolume/_data",
        "Name": "devvolume",
        "Options": {},
        "Scope": "local"
    }
]
```

You can get additional information such as labels that were used in creating this, perhaps the created at date. That might give me an idea if we didn't use the labels that created at date might give me an idea of what project it was created to work with. 

Let's go ahead and dig in a little bit into how we would actually go about using this container, and we can go ahead and start by mounting this volume into a container. Now I will note that originally there was a -V flag or --volume that was a standalone for containers. And then there was a -mount flag that we used for Swarm Services.

However, starting with Docker 17.06 you can actually use the --Mount Command with standalone containers. In general, the -mount command is more explicit and verbose. The biggest differences between -V syntax, it combines all of the options into one field, whereas the -mount syntax separates them. I'll use both in examples, one for our dev container 1, one for our dev container 2. So you can actually see what that looks like. So let's start out with creating the docker container run. Then we're gonna go ahead and create it detached. Let's go ahead and name this our dev container and we'll start off with our mount flag. So that's gonna be --mount. The source of our volume, and that's gonna be that dev volume . Now, our target is where inside of this container is it going to be mounted? Now? I'm gonna be using Nginx, and we've been talking this whole course about creating that hello world app, so I'll go ahead and mount in these apps and I'll use Nginx. 

```
$ docker container run -d --name devcont --mount source=devvolume,target=/app nginx
e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4
```

All right, let's do our docker container ls. 

```
$ docker container ls
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                   NAMES
e31c5e8ac5ab   nginx     "/docker-entrypoint.…"   58 seconds ago   Up 39 seconds   80/tcp                  devcont
4559deaefcb4   httpd     "httpd-foreground"       3 hours ago      Up 3 hours      0.0.0.0:80->80/tcp      sweet_williams
48812a5ebfef   nginx     "/docker-entrypoint.…"   3 hours ago      Up 3 hours      0.0.0.0:49153->80/tcp   sweet_galileo
278dd40f4569   nginx     "/docker-entrypoint.…"   4 hours ago      Up 4 hours      80/tcp                  nervous_kilby
```

We can see that we have a container up and running.

```
$ docker container ls
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                   NAMES
e31c5e8ac5ab   nginx     "/docker-entrypoint.…"   3 minutes ago   Up 3 minutes   80/tcp                  devcont
4559deaefcb4   httpd     "httpd-foreground"       3 hours ago     Up 3 hours     0.0.0.0:80->80/tcp      sweet_williams
48812a5ebfef   nginx     "/docker-entrypoint.…"   3 hours ago     Up 3 hours     0.0.0.0:49153->80/tcp   sweet_galileo
278dd40f4569   nginx     "/docker-entrypoint.…"   4 hours ago     Up 4 hours     80/tcp                  nervous_kilby
```

And we can see if this volume has indeed been connected to it by doing a docker container inspect.

```
$ docker container inspect devcont
[
    {
        "Id": "e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4",
        "Created": "2021-01-07T12:56:27.992063336Z",
        "Path": "/docker-entrypoint.sh",
        "Args": [
            "nginx",
            "-g",
            "daemon off;"
        ],
        "State": {
            "Status": "exited",
            "Running": false,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 0,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2021-01-07T12:56:45.766531576Z",
            "FinishedAt": "2021-01-07T14:30:09.16826001Z"
        },
        "Image": "sha256:ae2feff98a0cc5095d97c6c283dcd33090770c76d63877caa99aefbbe4343bdd",
        "ResolvConfPath": "/var/lib/docker/containers/e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4/resolv.conf",
        "HostnamePath": "/var/lib/docker/containers/e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4/hostname",
        "HostsPath": "/var/lib/docker/containers/e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4/hosts",
        "LogPath": "/var/lib/docker/containers/e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4/e31c5e8ac5abfe470519d767c29b4c4e7f6686158be5bd7c5b6fcbe8d1ece5b4-json.log",
        "Name": "/devcont",
        "RestartCount": 0,
        "Driver": "devicemapper",
        "Platform": "linux",
        "MountLabel": "",
        "ProcessLabel": "",
        "AppArmorProfile": "",
        "ExecIDs": null,
        "HostConfig": {
            "Binds": null,
            "ContainerIDFile": "",
            "LogConfig": {
                "Type": "json-file",
                "Config": {}
            },
            "NetworkMode": "default",
            "PortBindings": {},
            "RestartPolicy": {
                "Name": "no",
                "MaximumRetryCount": 0
            },
            "AutoRemove": false,
            "VolumeDriver": "",
            "VolumesFrom": null,
            "CapAdd": null,
            "CapDrop": null,
            "CgroupnsMode": "host",
            "Dns": [],
            "DnsOptions": [],
            "DnsSearch": [],
            "ExtraHosts": null,
            "GroupAdd": null,
            "IpcMode": "private",
            "Cgroup": "",
            "Links": null,
            "OomScoreAdj": 0,
            "PidMode": "",
            "Privileged": false,
            "PublishAllPorts": false,
            "ReadonlyRootfs": false,
            "SecurityOpt": null,
            "UTSMode": "",
            "UsernsMode": "",
            "ShmSize": 67108864,
            "Runtime": "runc",
            "ConsoleSize": [
                0,
                0
            ],
            "Isolation": "",
            "CpuShares": 0,
            "Memory": 0,
            "NanoCpus": 0,
            "CgroupParent": "",
            "BlkioWeight": 0,
            "BlkioWeightDevice": [],
            "BlkioDeviceReadBps": null,
            "BlkioDeviceWriteBps": null,
            "BlkioDeviceReadIOps": null,
            "BlkioDeviceWriteIOps": null,
            "CpuPeriod": 0,
            "CpuQuota": 0,
            "CpuRealtimePeriod": 0,
            "CpuRealtimeRuntime": 0,
            "CpusetCpus": "",
            "CpusetMems": "",
            "Devices": [],
            "DeviceCgroupRules": null,
            "DeviceRequests": null,
            "KernelMemory": 0,
            "KernelMemoryTCP": 0,
            "MemoryReservation": 0,
            "MemorySwap": 0,
            "MemorySwappiness": null,
            "OomKillDisable": false,
            "PidsLimit": null,
            "Ulimits": null,
            "CpuCount": 0,
            "CpuPercent": 0,
            "IOMaximumIOps": 0,
            "IOMaximumBandwidth": 0,
            "Mounts": [
                {
                    "Type": "volume",
                    "Source": "devvolume",
                    "Target": "/app"
                }
            ],
            "MaskedPaths": [
                "/proc/asound",
                "/proc/acpi",
                "/proc/kcore",
                "/proc/keys",
                "/proc/latency_stats",
                "/proc/timer_list",
                "/proc/timer_stats",
                "/proc/sched_debug",
                "/proc/scsi",
                "/sys/firmware"
            ],
            "ReadonlyPaths": [
                "/proc/bus",
                "/proc/fs",
                "/proc/irq",
                "/proc/sys",
                "/proc/sysrq-trigger"
            ]
        },
        "GraphDriver": {
            "Data": {
                "DeviceId": "49",
                "DeviceName": "docker-259:1-487194-6c835dcc3ac7d0aaf4e6afc4c4866a1719dc9a183c9c221c116fef389d6777ee",
                "DeviceSize": "10737418240"
            },
            "Name": "devicemapper"
        },
        "Mounts": [
            {
                "Type": "volume",
                "Name": "devvolume",
                "Source": "/var/lib/docker/volumes/devvolume/_data",
                "Destination": "/app",
                "Driver": "local",
                "Mode": "z",
                "RW": true,
                "Propagation": ""
            }
        ],
        "Config": {
            "Hostname": "e31c5e8ac5ab",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "80/tcp": {}
            },
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "NGINX_VERSION=1.19.6",
                "NJS_VERSION=0.5.0",
                "PKG_RELEASE=1~buster"
            ],
            "Cmd": [
                "nginx",
                "-g",
                "daemon off;"
            ],
            "Image": "nginx",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": [
                "/docker-entrypoint.sh"
            ],
            "OnBuild": null,
            "Labels": {
                "maintainer": "NGINX Docker Maintainers <docker-maint@nginx.com>"
            },
            "StopSignal": "SIGQUIT"
        },
        "NetworkSettings": {
            "Bridge": "",
            "SandboxID": "cb2ef53941b8b3ee72f92a1298eb9b4ae3fc54f9a838b12c9d81329e69d84388",
            "HairpinMode": false,
            "LinkLocalIPv6Address": "",
            "LinkLocalIPv6PrefixLen": 0,
            "Ports": {},
            "SandboxKey": "/var/run/docker/netns/cb2ef53941b8",
            "SecondaryIPAddresses": null,
            "SecondaryIPv6Addresses": null,
            "EndpointID": "",
            "Gateway": "",
            "GlobalIPv6Address": "",
            "GlobalIPv6PrefixLen": 0,
            "IPAddress": "",
            "IPPrefixLen": 0,
            "IPv6Gateway": "",
            "MacAddress": "",
            "Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "bc024bc32d38a31d58fd7348f96e95b3e68c47a6e12ce145acd136e307f2de3c",
                    "EndpointID": "",
                    "Gateway": "",
                    "IPAddress": "",
                    "IPPrefixLen": 0,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "",
                    "DriverOpts": null
                }
            }
        }
    }
]
```

*** WE ARE HERE ***

And we can see under Mounts we have the type is volume, its name is devvolume. Its source is gonna be that internal local storage located at var/lib/docker/volumes/devvolume/_data, and its destination is inside of our container in our app directory. We can actually go into the container and take a look at that. All right, so we're gonna be needing our sudo permission, and we're gonna do ls/var/lib/docker/volumes and we can see our dev volume resides here. We can list out information inside of it. As we would expect there really isn't anything in here. It really is what we would expect as we only have that place holder here, so we can actually go into the container and create some data. Let's do that by using the docker container exect command. Now we'll go ahead and execute an interactive terminal with a shell command. It would help if I would use the command exec, not exect. So here we're logged into my container. We could do an ls and we can see our app directory. Let's create a file in this app directory. We're just gonna echo hello inside of hello.txt We can do an ls inside of app and see if our  hello file is there. Let's exit out. We can use that ls command to see what's inside of our volume data. Hello text. So what happens if we stop our container? Let's do a docker container stop devcont. We're going to go ahead and actually remove this container from our system. What happens now if we list out the data inside of that volume? It's still here. Let's create a brand new container and let's do docker container run. We're gonna go ahead and create it in a detached mode as always. Let's go ahead and stick with our naming convention and name this container devcont 2. And we'll go ahead and use our -v flag now instead of our mount flag. So we're going to mount devvolume to app. We're gonna use our Nginx image, and there you go. We have a brand new container called devcont2, and devvolume is connected to that container. Let's go ahead and execute a shell into this container so we can see if our hello.txt is there. Do an ls, we see app, go ahead, and list out what's inside of app. What do you know, our hello.txt is indeed in this brand new container. Let's cat that out just to make sure that our data did persist. There you go, hello. Just for a few giggles and maybe to solidify this in our mind, let's go ahead and create a new file inside of this container. We'll go ahead and call this one goodbye and let's just say goodbye. Go ahead and exit, and we're gonna list out those files inside of our volume one more time. And here you go. There is our goodbye.txt. Hopefully you have a better understanding now of how to start using Docker Volume. If you want to know more, I'd encourage you to continue on with our darker, deep dive course. For now though, go ahead and close out this video and continue on with your journey.
